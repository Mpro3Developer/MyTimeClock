/*
 *  MproEntityJS Beta
 */
function Ajax(){this.Url="";var e="",t=null,n=null;$.ajaxSetup({cache:!1}),this.setData=function(t){e=t},this.onSucces=function(e){t=e},this.onError=function(e){n=e},this.execute=function(r){void 0===r&&(r=!0),$.ajax({async:r,type:"post",cache:!1,url:this.Url+"?cache="+(new Date).getTime()+Math.random(),data:e,success:function(e){null!==t&&t(e)},error:function(e){console.log(e),null!==n&&n(e)}})}}function LauDB(){function e(e){for(var t=Object.keys(e).map(function(t){return e[t]}),n=0;n<t.length;n++)t[n]=Object.keys(t[n]).map(function(e){return t[n][e]});return t}var t,n=!0;t=openDatabase("MproEntity","1.0","MproEntityLauDB",2e5),t||console.error("L.A.U Connect error"),this.enableFetch=function(){n=!0},this.disableFetch=function(){n=!1},this.query=function(r,o){t.transaction(function(t){t.executeSql(r,null,function(t,r){o(n?e(r.rows):r.rows)},function(e,t){LauDB.debug&&console.error("L.A.U Query error: "+t.message+" :: cmd-> "+r)})})},this.noReturnDataQuery=function(e){t.transaction(function(t){t.executeSql(e,[[]],function(e,t){},function(t,n){LauDB.debug&&console.error("L.A.U Query error: "+n.message+" :: cmd-> "+e)})})},this.row=function(e,t,n){LauDB.debug&&console.error("Not implemented yet ...")},this.execute=function(e){t.transaction(function(t){t.executeSql(e,null,null,function(t,n){LauDB.debug&&console.error("L.A.U Query error: "+n.message+" :: cmd-> "+e)})})},this.getLastInsertRowid=function(e){this.query("SELECT last_insert_rowid();",function(t){e(t[0])})},this.rowCount=function(){LauDB.debug&&console.error("Not implemented yet ...")},this.prox=function(){LauDB.debug&&console.error("Not implemented yet ...")},this.getActualObjectRow=function(){LauDB.debug&&console.error("Not implemented yet ...")},this.close=function(){LauDB.debug&&console.error("Is not necessary ...")}}function IDBLauDB(){this.obj=null,this.conn=null,this["delete"]=function(e,t){this.conn.remove(e,function(e){t(e)},function(e){console.error("L.A.U indexedDB :: "+e)})},this.createIndexes=function(e){var t=JSON.stringify(e);this.obj=JSON.parse(t);for(var n=[],r=0;r<this.obj.Fields.length;r++)n.push({name:this.obj.Fields[r],keyPath:this.obj.Fields[r],unique:!1,multiEntry:!0});IDBLauDB.__indexedsUsed[this.obj.Name]=n,this.conn=new IDBStore({dbVersion:MproEntity.indexedDBVersion,storeName:this.obj.Name,keyPath:"cod",autoIncrement:!0,indexes:n,onStoreReady:function(){}})},this.insert=function(e,t){2147483647==e.cod&&(e.cod=void 0),this.conn.put(e,function(e){t(e)},function(e){console.error("L.A.U indexedDB :: "+e)})},this.selectAll=function(e){this.conn.getAll(function(t){e(t)},function(e){console.error("L.A.U indexedDB :: "+e)})},this.selectWhere=function(){},this.setJSONObject=function(e,t){var n=JSON.stringify(e);this.obj=JSON.parse(n),this.createTable(t)},this.createTable=function(e){this.conn=new IDBStore({dbVersion:MproEntity.indexedDBVersion,storeName:this.obj.Name,keyPath:"cod",autoIncrement:!0,indexes:IDBLauDB.__indexedsUsed[this.obj.Name],onStoreReady:function(){e()}})}}function InternalEnviroment(e){function t(e){var t=JSON.parse(e),n=new SQLBuilder;return n.setJSONObject(t),n}function n(e){var t=e[4].split(",");return t[0]=t[0].replace(new RegExp("create\\s+table\\s+"+e[1]+"\\s*\\(","i"),""),e.fields=t.map(function(e){return e.trim().split(/\s/).shift()}).filter(function(e){return-1===e.indexOf(")")}),e}var r=new LauDB;this.removeService=function(e){for(var n=t(e),o=n["delete"](),i=0;i<o.length;i++)r.execute(o[i])},this.recordService=function(e,n){var o=JSON.parse(e),i=t(e);o.CodRef?(r.execute(i.createRefTable()),r.execute(i.insertRef()),n&&n()):2147483647===o.Cod?(r.execute(i.insert()),r.getLastInsertRowid(function(e){n&&n(e)})):(r.execute(i.update()),n&&n())},this.requestAllService=function(e,n){var o=t(e);r.query(o.selectAll(),function(e){n(e)})},this.requestService=function(e,n){var o=t(e);r.query(o.selectWhere(),function(e){n(e)})},this.createTableService=function(e){var o=t(e);r.execute(o.createTable()),r.execute(o.createRefTable()),r.query(o.describeTable(),function(e){var t=n(e[0]);e=[];for(var i=0;i<t.fields.length;i++)e.push(t.fields[i]);for(var s=o.alterTable(e),i=0;i<s.length;i++)r.execute(s[i])})}}function SQLBuilder(){function e(e){return!(+e!==e||isFinite(e)&&!(e%1))}function t(t){var n,r=typeof t,o=function(e){var t=/\W*function\s+([\w\$]+)\s*\(/.exec(e);return t?t[1]:"(Anonymous)"};return"object"===r?null!==t?"number"!=typeof t.length||t.propertyIsEnumerable("length")||"function"!=typeof t.splice?t.constructor&&o(t.constructor)&&(n=o(t.constructor),"Date"===n?r="date":"RegExp"===n?r="regexp":"PHPJS_Resource"===n&&(r="resource")):r="array":r="null":"number"===r&&(r=e(t)?"double":"integer"),r}this["delete"]=function(){var e=[];return""===this.obj.NameRef?(e.push("DELETE FROM "+this.obj.Name+" WHERE cod = "+this.obj.Cod+";"),e.push("DELETE FROM Reference WHERE cod = "+this.obj.Cod+"  AND class = '"+this.obj.Name+"';")):e.push("DELETE FROM Reference WHERE cod = "+this.obj.CodRef+" AND codref = "+this.obj.Cod+" AND class = '"+this.obj.NameRef+"' AND classref = '"+this.obj.Name+"';"),e},this.insertRef=function(){return"INSERT INTO Reference VALUES('"+this.obj.NameRef+"', '"+this.obj.Name+"', "+this.obj.Ix+", "+this.obj.CodRef+", "+this.obj.Cod+");"},this.insert=function(){return"INSERT INTO "+this.obj.Name+" VALUES(NULL, "+this.obj.Fields+")"},this.selectAll=function(){var e="";return e=""===this.obj.NameRef?"SELECT * FROM "+this.obj.Name+" "+(""===this.obj.Where?"ORDER BY ":" WHERE ("+this.obj.Where+") ORDER BY ")+this.obj.OrderBy:"SELECT * FROM "+this.obj.Name+" WHERE cod in (SELECT codref FROM Reference WHERE class = '"+this.obj.NameRef+"' and cod = "+this.obj.CodRef+" AND classref = '"+this.obj.Name+"' "+(2147483647!==this.obj.Ix?" AND ix = "+this.obj.Ix+" ":"")+")  "+(""===this.obj.Where?"ORDER BY ":" AND ("+this.obj.Where+") ORDER BY ")+this.obj.OrderBy,this.obj.Limiter.length&&(e+=" LIMIT "+this.obj.Limiter[0]+", "+this.obj.Limiter[1]),e},this.selectWhere=function(){for(var e="SELECT "+this.obj.Name+".cod, ",n="",r="",o=0;o<this.obj.Fields.length;o++)e+=this.obj.Name+"."+this.obj.Fields[o]+", ";e=e.replace(/, $/gm,""),e+=" FROM "+this.obj.Name+" ";for(var o=0;o<this.obj.NameRefs.length;o++)n+=" INNER JOIN Reference ON Reference.cod = "+this.obj.Name+".cod INNER JOIN "+this.obj.NameRefs[o]+" ON "+this.obj.NameRefs[o]+".cod = Reference.codref AND Reference.classref = '"+this.obj.NameRefs[o]+"' ",r+=""+this.obj.NameRefs[o]+"."+this.obj.FieldsRefs[o]+" "+this.obj.Comparators[o]+" "+("string"==t(this.obj.LogicVals[o])?"'"+(" LIKE "===this.obj.Comparators[o]?"%":"")+this.obj.LogicVals[o]+(" LIKE "===this.obj.Comparators[o]?"%":"")+"'":this.obj.LogicVals[o])+" "+(null==this.obj.LogicNexts[o]?"":this.obj.LogicNexts[o]);return e+=""!==r?n+" WHERE "+r+" "+(""!=this.obj.OrderBy?" ORDER BY "+this.obj.OrderBy:""):n+" WHERE "+this.obj.Where+" "+(""!=this.obj.OrderBy?" ORDER BY "+this.obj.OrderBy:"")},this.setJSONObject=function(e){this.obj=e},this.update=function(){return update="UPDATE "+this.obj.Name+" SET "+this.obj.Fields,update+=" WHERE cod = "+this.obj.Cod,update},this.createTable=function(){return"CREATE TABLE "+this.obj.Name+" (cod INTEGER PRIMARY KEY)"},this.alterTable=function(e){for(var t=[],n=[],r=!1,o=[],i=[],s=[],a=1;a<e.length;a++)s[e[a]]=!0;for(var a=0;a<this.obj.Fields.length;a++)t.push("ALTER TABLE "+this.obj.Name+" ADD "+this.obj.Fields[a]+" "+this.obj.Types[a]),s[this.obj.Fields[a]]?(o.push(this.obj.Fields[a]),i.push(this.obj.Types[a])):r=!0;if(e.length-1>this.obj.Fields.length&&(r=!0),r){for(n.push("CREATE TABLE back_"+this.obj.Name+" (cod INTEGER PRIMARY KEY);"),a=0;a<o.length;a++)n.push("ALTER TABLE back_"+this.obj.Name+" ADD "+o[a]+" "+i[a]);n.push("INSERT INTO back_"+this.obj.Name+" SELECT cod, "+o.join(",")+" FROM "+this.obj.Name+";"),n.push("DROP TABLE "+this.obj.Name+";"),n.push(this.createTable()),n=n.concat(t),n.push("INSERT INTO "+this.obj.Name+"(cod, "+o.join(",")+") SELECT cod, "+o.join(",")+" FROM back_"+this.obj.Name+";"),n.push("DROP TABLE back_"+this.obj.Name+";")}return t.length>n.length?t:n},this.createRefTable=function(){return"CREATE TABLE IF NOT EXISTS Reference (class TEXT, classref TEXT, ix INTEGER, cod INTEGER, codref INTEGER, PRIMARY KEY(class, classref, ix, cod, codref));"},this.describeTable=function(){return"SELECT * FROM sqlite_master WHERE name = '"+this.obj.Name+"'"}}function MproEntity(){function e(){var e="";for(var t in o)if("getAll"!==t&&"class"!==t&&"Save"!==t&&"cod"!==t&&"codRemote"!==t&&"Delete"!==t&&"RefObject"!==t&&"function"!=typeof o[t]&&!(o[t]instanceof Array||a[t]))if(-1!==t.indexOf("Ref")){var n=o[t].cod;e+=("string"==typeof n?"'":"")+n+("string"==typeof n?"'":"")+", "}else-1!==t.indexOf("Crypt")&&-1===o[t].indexOf("{}")?(o[t]="{}"+CryptoJS.SHA1(o[t]),e+=("string"==typeof o[t]?"'":"")+o[t]+("string"==typeof o[t]?"'":"")+", "):e+=("string"==typeof o[t]?"'":"")+o[t]+("string"==typeof o[t]?"'":"")+", ";return e=e.replace(/, $/,"")}function t(){var e="";for(var t in o)if("getAll"!==t&&"class"!==t&&"Save"!==t&&"cod"!==t&&"codRemote"!==t&&"Delete"!==t&&"RefObject"!==t&&"function"!=typeof o[t]&&!(o[t]instanceof Array||a[t]))if(-1!==t.indexOf("Ref")){var n=o[t].cod;e+=t+" = "+("string"==typeof n?"'":"")+n+("string"==typeof n?"'":"")+", "}else if(-1!==t.indexOf("Crypt")){var n=o[t];-1===n.indexOf("{}")&&(n="{}"+CryptoJS.SHA1(n)),e+=t+" = "+("string"==typeof n?"'":"")+n+("string"==typeof n?"'":"")+", "}else e+=t+" = "+("string"==typeof o[t]?"'":"")+o[t]+("string"==typeof o[t]?"'":"")+", ";return e=e.replace(/, $/,"")}function n(e){if(MproEntity.canCreateTables){var t=(new Array,new MproEntity.CreateTable);if(""!==o["class"]){t.Name=o["class"];for(var n in o)"getAll"!==n&&"cod"!==n&&"codRemote"!==n&&"class"!==n&&"Save"!==n&&"Delete"!==n&&"RefObject"!==n&&"function"!=typeof o[n]&&(o[n]instanceof Array||a[n]||(t.Fields.push(n),t.Types.push("number"==typeof o[n]?"NUMERIC":"TEXT")));if(MproEntity.indexedDB&&!e){var r=new IDBLauDB;r.createIndexes(t)}if(!window.externalEnvironment&&!MproEntity.indexedDB||e){var i=new Ajax;i.Url=(e?MproEntity.remoteServer:MproEntity.serverUrl)+"/createTableService"+(e?MproEntity.remoteServerTech:MproEntity.serverTech),i.setData({createTable:JSON.stringify(t),user:__projectUser__,cod:__projectCod__}),i.onSucces(function(e){}),i.execute()}window.externalEnvironment&&!e&&externalEnvironment.createTableService(JSON.stringify(t))}}}function r(){for(var e in o)"getAll"!==e&&"class"!==e&&"Save"!==e&&"Delete"!==e&&"function"!=typeof o[e]&&"RefObject"!==e&&"function"!=typeof o[e]&&("string"==typeof o[e]?o[e]=null:"number"==typeof o[e]&&(o[e]=2147483647))}var o=this,i=!1,s=new Array,a=new Array;if(this.cod=2147483647,this.codRemote=2147483647,this.RefObject=null,this["class"]=this.constructor.name,void 0===window[this["class"]]["class"]){window[this["class"]]["class"]={};for(var c in o)if("class"!==c&&"RefObject"!==c&&"function"!=typeof o[c]){window[this["class"]]["class"][c]={field:c,"class":this["class"]};var o=this;window[this["class"]].getName=function(){return o["class"]},window[this["class"]].prototype["set"+c]=function(e){return function(t){this[e]=t}}(c),window[this["class"]].prototype["get"+c]=function(e){return function(){return this[e]}}(c)}}s=MproEntityAnnotations.getReferences(this),s.length>0&&(i=!0),a=MproEntityAnnotations.getTransients(this),MproEntity.serverSeted||(MproEntity.serverUrl="server",MproEntity.serverTech=".php"),void 0===this["class"]&&(this["class"]=""),this.getInfo=function(){var e=new MproEntity.DataRequest;e.Name=this["class"];for(var t in this)this[t]instanceof Array||a[t]||"getAll"!==t&&"cod"!==t&&"codRemote"!==t&&"class"!==t&&"Save"!==t&&"Delete"!==t&&"RefObject"!==t&&"function"!=typeof this[t]&&e.Fields.push(t);return e},this.DeleteRemote=function(e,t){var n=new MproEntity.DataReference;if(0===o.codRemote)return 0;o.RefObject?(n.Name=o["class"],n.Cod=o.codRemote,n.NameRef=o.RefObject["class"],n.CodRef=o.RefObject.codRemote):(n.Name=o["class"],n.Cod=o.codRemote);var r=$.extend(!0,[],s),a=new Ajax;a.Url=MproEntity.remoteServer+"/dataRemoveService"+MproEntity.remoteServerTech,a.setData({dataRemove:JSON.stringify(n),user:__projectUser__,cod:__projectCod__}),a.onSucces(function(e){if(i)for(var t=0;t<r.length;t++)for(var n=o[r[t].NameVar],s=0;s<n.length;s++)n[s].DeleteRemote(r[t].Name,o.codRemote)}),a.execute()},this.Delete=function(e,t){var n=new MproEntity.DataReference;if(0===o.cod)return 0;o.RefObject?(n.Name=o["class"],n.Cod=o.cod,n.NameRef=o.RefObject["class"],n.CodRef=o.RefObject.cod):(n.Name=o["class"],n.Cod=o.cod);var r=$.extend(!0,[],s);if(MproEntity.indexedDB){var a=new IDBLauDB;a.setJSONObject(n,function(){a["delete"](o.cod,function(){o.cod=null})})}else if(window.externalEnvironment){if(externalEnvironment.removeService(JSON.stringify(n)),o.cod=2147483647,i)for(var c=0;c<r.length;c++)for(var l=o[r[c].NameVar],u=0;u<l.length;u++)l[u].Delete(r[c].Name,o.cod)}else{var h=new Ajax;h.Url=MproEntity.serverUrl+"/dataRemoveService"+MproEntity.serverTech,h.setData({dataRemove:JSON.stringify(n),user:__projectUser__,cod:__projectCod__}),h.onSucces(function(e){if(i)for(var t=0;t<r.length;t++)for(var n=o[r[t].NameVar],s=0;s<n.length;s++)n[s].Delete(r[t].Name,o.cod)}),h.execute()}},this.SaveRemote=function(n,r,a){var c=!1,l=new MproEntity.DataRecord;l.Cod=o.cod,l.Remote=!0;var u=o.cod;arguments.length||2147483647!==o.codRemote?2147483647!==o.codRemote&&(o.cod=o.codRemote):o.cod=2147483647,2147483647===o.cod?(l.Name=o["class"],l.Fields=e(),c=!0):(l.Name=o["class"],l.Fields=t());var h=$.extend(!0,[],s);o.cod=u;var f=new Ajax;f.Url=MproEntity.remoteServer+"/dataRecordService"+MproEntity.remoteServerTech,f.setData({dataRecord:JSON.stringify(l),user:__projectUser__,cod:__projectCod__}),f.onSucces(function(e){if(c&&(o.codRemote=parseInt(e)),n&&r){var t=new MproEntity.DataReference;if(t.Cod=o.cod,t.Name=o["class"],t.NameRef=n,t.Ix=a,t.CodRef=r,window.externalEnvironment)window.externalEnvironment.Table();else{var s=new Ajax;s.Url=MproEntity.remoteServer+"/dataRecordService"+MproEntity.remoteServerTech,s.setData({dataRecord:JSON.stringify(t),user:__projectUser__,cod:__projectCod__}),s.onSucces(function(e){}),s.execute()}}if(i)for(var l=0;l<h.length;l++)for(var u=o[h[l].NameVar],f=0;f<u.length;f++)u[f].SaveRemote(o["class"],o.cod,h[l].Ix)}),f.execute()},this.Save=function(n,r,a){var c=!1,l=new MproEntity.DataRecord;l.Cod=o.cod,2147483647===o.cod?(l.Name=o["class"],l.Fields=e(),c=!0):(l.Name=o["class"],l.Fields=t());var u=$.extend(!0,[],s);if(MproEntity.indexedDB){var h=new IDBLauDB;h.setJSONObject(l,function(){h.insert(JSON.parse(JSON.stringify(o)),function(e){o.cod=e})})}else if(window.externalEnvironment)externalEnvironment.recordService(JSON.stringify(l),function(e){if(c&&(o.cod=e),n&&r){var t=new MproEntity.DataReference;t.Cod=o.cod,t.Name=o["class"],t.NameRef=n,t.Ix=a,t.CodRef=r,externalEnvironment.recordService(JSON.stringify(t))}if(i)for(var s=0;s<u.length;s++)for(var l=o[u[s].NameVar],h=0;h<l.length;h++)l[h].Save(o["class"],o.cod,u[s].Ix)});else{var f=new Ajax;f.Url=MproEntity.serverUrl+"/dataRecordService"+MproEntity.serverTech,f.setData({dataRecord:JSON.stringify(l),user:__projectUser__,cod:__projectCod__}),f.onSucces(function(e){if(c&&(o.cod=parseInt(e)),n&&r){var t=new MproEntity.DataReference;if(t.Cod=o.cod,t.Name=o["class"],t.NameRef=n,t.Ix=a,t.CodRef=r,window.externalEnvironment)window.externalEnvironment.Table();else{var s=new Ajax;s.Url=MproEntity.serverUrl+"/dataRecordService"+MproEntity.serverTech,s.setData({dataRecord:JSON.stringify(t),user:__projectUser__,cod:__projectCod__}),s.onSucces(function(e){}),s.execute()}}if(i)for(var l=0;l<u.length;l++)for(var h=o[u[l].NameVar],f=0;f<h.length;f++)h[f].Save(o["class"],o.cod,u[l].Ix)}),f.execute()}},r(),n(),MproEntity.remoteServer&&n(!0)}function Query(e){function t(){return"eq"==a[a.length-1]||"neq"==a[a.length-1]||"like"==a[a.length-1]||"bigger"==a[a.length-1]||"less"==a[a.length-1]||"biggerEq"==a[a.length-1]||"lessEq"==a[a.length-1]||"between"==a[a.length-1]}function n(){return"and"==a[a.length-1]||"or"==a[a.length-1]}function r(e,t,n,r){if(0!=a.length)throw new Error("(where) can not be called after other method");return a.push("whereo"),n.NameRefs.push(e.getName()),n.FieldsRefs.push(t),r}function o(e,n,r,o){if(!t()||-1==a.indexOf("whereo"))throw new Error("(and) only can be called after (like, equal, bigger, less etc ...)");return r.LogicNexts[r.LogicNexts.length-1]=" AND ",r.NameRefs.push(e.getName()),r.FieldsRefs.push(n),a.push("or"),o}function i(e,n,r,o){if(!t()||-1==a.indexOf("whereo"))throw new Error("(or) only can be called after (like, equal, bigger, less etc ...)");return r.LogicNexts[r.LogicNexts.length-1]=" OR ",r.NamesRef.push(e.getName()),r.FieldsRef.push(n),a.push("or"),o}function s(){return a.length>0?a.length%2==0?!0:"limit"==a[a.length-1]?!0:!1:!0}var a=[];this.objectInfo=new MproEntity.DataRequest;var c="",l="",u="";this.newInstanceOfT=function(){var t=new e,n=t.getInfo();return this.objectInfo=n,t};this.newInstanceOfT();this.where=function(e){if(2==arguments.length)return r(arguments[0],arguments[1],this.objectInfo,this);if(0!=a.length)throw new Error("(where) can not be called after other method");return a.push("where"),c+=""+e+" ",l+="i."+e+" ",u=e,this},this.equal=function(e){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" = "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ",l+=" == "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(equal) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" = "),this.objectInfo.LogicVals.push(e),this.objectInfo.LogicNexts.push(null)}return a.push("eq"),this},this.notEqual=function(e){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" <> "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ",l+=" != "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(notEqual) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" <> "),this.objectInfo.LogicVals.push(e),this.objectInfo.LogicNexts.push(null)}return a.push("neq"),this},this.like=function(e){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" LIKE "+("string"==typeof e?"'%"+e.toString()+"%'":e.toString())+" ",l+=" .indexOf( "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+") != -1 ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(like) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" LIKE "),this.objectInfo.LogicVals.push(e),this.objectInfo.LogicNexts.push(null)}return a.push("like"),this},this.between=function(e,r){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" BETWEEN "+("string"==typeof e?"'%"+e.toString()+"%'":e.toString())+" AND "+("string"==typeof r?"'%"+e.toString()+"%'":r.toString())+" ",l+=" >= "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" && i."+u+" <= "+("string"==typeof r?"'"+e.toString()+"'":r.toString())+" ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(between) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" BETWEEN "+("string"==typeof e?"'%"+e.toString()+"%'":e.toString())+" AND "),this.objectInfo.LogicVals.push(r),this.objectInfo.LogicNexts.push(null)}return a.push("between"),this},this.bigger=function(e){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" > "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ",l+=" > "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(bigger) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" > "),this.objectInfo.LogicVals.push(e),this.objectInfo.LogicNexts.push(null)}return a.push("bigger"),this},this.less=function(e){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" < "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ",l+=" > "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(less) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" < "),this.objectInfo.LogicVals.push(e),this.objectInfo.LogicNexts.push(null)}return a.push("less"),this},this.biggerAndEqual=function(e){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" >= "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ",l+=" >= "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(biggerAndEqual) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" >= "),this.objectInfo.LogicVals.push(e),this.objectInfo.LogicNexts.push(null)}return a.push("biggerEq"),this},this.lessAndEqual=function(e){if(a.length>0&&("where"==a[a.length-1]||n())&&-1==a.indexOf("whereo"))c+=" <= "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ",l+=" <= "+("string"==typeof e?"'"+e.toString()+"'":e.toString())+" ";else{if(-1==a.indexOf("whereo")||t())throw new Error("(lessAndEqual) only can be called after where or after (or, and)");this.objectInfo.Comparators.push(" <= "),this.objectInfo.LogicVals.push(e),this.objectInfo.LogicNexts.push(null)}return a.push("lessEq"),this},this.and=function(e){if(2==arguments.length)return o(arguments[0],arguments[1],this.objectInfo);if(a.length>0&&t()&&-1==a.indexOf("whereo"))c+="AND "+e+" ",l+=" && i."+e+" ",u=e;else{if(!t()||-1==a.indexOf("whereo"))throw new Error("(and) only can be called after (like, equal, bigger, less etc ...)");this.objectInfo.LogicNexts[this.objectInfo.LogicNexts.lenght-1]=" AND "}return a.push("and"),this},this.or=function(e){if(2==arguments.length)return i(arguments[0],arguments[1],this.objectInfo,this);if(!(a.length>0&&t()&&-1==a.indexOf("whereo")))throw t()&&-1!=a.indexOf("whereo")?new Error("(or) used without class reference in (where) with reference"):new Error("(and) only can be called after (like, equal, bigger, less etc ...)");return c+="OR "+e+" ",l+=" || i."+e+" ",u=e,a.push("or"),this},this.orderBy=function(e){return this.objectInfo.OrderBy=" "+e,a.push("order"),this},this.asc=function(){if("order"!=a[a.length-1])throw new Error("(asc) only can be called after (orderBy)");return this.objectInfo.OrderBy+=" ASC",a.push("asc"),this},this.desc=function(){if("order"!=a[a.length-1])throw new Error("(desc) only can be called after (orderBy)");return this.objectInfo.OrderBy+=" DESC",a.push("desc"),this},this.limit=function(e,t){return this.objectInfo.Limiter=[],this.objectInfo.Limiter[0]=e,this.objectInfo.Limiter[1]=t,a.push("limit"),this},this.debug=function(){this.objectInfo.Where=c,this.objectInfo.IndexWhere=l,MproEntity.indexedDB?console.log("FILTER -> "+this.objectInfo.IndexWhere):console.log("SQL -> "+this.objectInfo.Where)},this.execute=function(t){if(!s())throw new Error("Your query appears incomplete. Make sure you are not missing after (where, or, and) one comparator (like, equal, notEqual, bigger, less, between) or missing after (orderBy) one order (asc, desc)");this.objectInfo.Where=c,this.objectInfo.IndexWhere=l,MproEntity.getWhere(e,this.objectInfo,t)},this.executeRemote=function(t){if(!s())throw new Error("Your query appears incomplete. Make sure you are not missing after (where, or, and) one comparator (like, equal, notEqual, bigger, less, between) or missing after (orderBy) one order (asc, desc)");this.objectInfo.Where=c,this.objectInfo.IndexWhere=l,MproEntity.getWhere(e,this.objectInfo,t,!0)}}!function(e,t,n){"function"==typeof define?define(t):"undefined"!=typeof module&&module.exports?module.exports=t():n[e]=t()}("IDBStore",function(){var e=function(e){throw e},t=function(){},n={storeName:"Store",storePrefix:"IDBWrapper-",dbVersion:1,keyPath:"id",autoIncrement:!0,onStoreReady:function(){},onError:e,indexes:[],implementationPreference:["indexedDB","webkitIndexedDB","mozIndexedDB","shimIndexedDB"]},r=function(e,t){"undefined"==typeof t&&"function"==typeof e&&(t=e),"[object Object]"!=Object.prototype.toString.call(e)&&(e={});for(var r in n)this[r]="undefined"!=typeof e[r]?e[r]:n[r];this.dbName=this.storePrefix+this.storeName,this.dbVersion=parseInt(this.dbVersion,10)||1,t&&(this.onStoreReady=t);var o="object"==typeof window?window:self;this.implementation=this.implementationPreference.filter(function(e){return e in o})[0],this.idb=o[this.implementation],this.keyRange=o.IDBKeyRange||o.webkitIDBKeyRange||o.mozIDBKeyRange,this.consts={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange",NEXT:"next",NEXT_NO_DUPLICATE:"nextunique",PREV:"prev",PREV_NO_DUPLICATE:"prevunique"},this.openDB()};r.prototype={constructor:r,version:"1.6.1",db:null,dbName:null,dbVersion:null,store:null,storeName:null,storePrefix:null,keyPath:null,autoIncrement:null,indexes:null,implementationPreference:null,implementation:"",onStoreReady:null,onError:null,_insertIdCount:0,openDB:function(){var e=this.idb.open(this.dbName,this.dbVersion),t=!1;e.onerror=function(e){var t=!1;"error"in e.target?t="VersionError"==e.target.error.name:"errorCode"in e.target&&(t=12==e.target.errorCode),t?this.onError(Error("The version number provided is lower than the existing one.")):this.onError(e)}.bind(this),e.onsuccess=function(e){if(!t)if(this.db)this.onStoreReady();else if(this.db=e.target.result,"string"==typeof this.db.version)this.onError(Error("The IndexedDB implementation in this browser is outdated. Please upgrade your browser."));else if(this.db.objectStoreNames.contains(this.storeName)){this.store=this.db.transaction([this.storeName],this.consts.READ_ONLY).objectStore(this.storeName);var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var r=e.name;r?(this.normalizeIndexData(e),this.hasIndex(r)?(this.indexComplies(this.store.index(r),e)||(t=!0,this.onError(Error('Cannot modify index "'+r+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),n.splice(n.indexOf(r),1)):(t=!0,this.onError(Error('Cannot create new index "'+r+'" for current version. Please bump version number to '+(this.dbVersion+1)+".")))):(t=!0,this.onError(Error("Cannot create index: No index name given.")))},this),n.length&&(t=!0,this.onError(Error('Cannot delete index(es) "'+n.toString()+'" for current version. Please bump version number to '+(this.dbVersion+1)+"."))),t||this.onStoreReady()}else this.onError(Error("Object store couldn't be created."))}.bind(this),e.onupgradeneeded=function(e){this.db=e.target.result,this.db.objectStoreNames.contains(this.storeName)?this.store=e.target.transaction.objectStore(this.storeName):(e={autoIncrement:this.autoIncrement},null!==this.keyPath&&(e.keyPath=this.keyPath),this.store=this.db.createObjectStore(this.storeName,e));var n=Array.prototype.slice.call(this.getIndexList());this.indexes.forEach(function(e){var r=e.name;r||(t=!0,this.onError(Error("Cannot create index: No index name given."))),this.normalizeIndexData(e),this.hasIndex(r)?(this.indexComplies(this.store.index(r),e)||(this.store.deleteIndex(r),this.store.createIndex(r,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})),n.splice(n.indexOf(r),1)):this.store.createIndex(r,e.keyPath,{unique:e.unique,multiEntry:e.multiEntry})},this),n.length&&n.forEach(function(e){this.store.deleteIndex(e)},this)}.bind(this)},deleteDatabase:function(e,t){if(this.idb.deleteDatabase){this.db.close();var n=this.idb.deleteDatabase(this.dbName);n.onsuccess=e,n.onerror=t}else t(Error("Browser does not support IndexedDB deleteDatabase!"))},put:function(n,r,o,i){null!==this.keyPath&&(i=o,o=r,r=n),i||(i=e),o||(o=t);var s=!1,a=null,c=this.db.transaction([this.storeName],this.consts.READ_WRITE);return c.oncomplete=function(){(s?o:i)(a)},c.onabort=i,c.onerror=i,null!==this.keyPath?(this._addIdPropertyIfNeeded(r),n=c.objectStore(this.storeName).put(r)):n=c.objectStore(this.storeName).put(r,n),n.onsuccess=function(e){s=!0,a=e.target.result},n.onerror=i,c},get:function(n,r,o){o||(o=e),r||(r=t);var i=!1,s=null,a=this.db.transaction([this.storeName],this.consts.READ_ONLY);return a.oncomplete=function(){(i?r:o)(s)},a.onabort=o,a.onerror=o,n=a.objectStore(this.storeName).get(n),n.onsuccess=function(e){i=!0,s=e.target.result},n.onerror=o,a},remove:function(n,r,o){o||(o=e),r||(r=t);var i=!1,s=null,a=this.db.transaction([this.storeName],this.consts.READ_WRITE);return a.oncomplete=function(){(i?r:o)(s)},a.onabort=o,a.onerror=o,n=a.objectStore(this.storeName)["delete"](n),n.onsuccess=function(e){i=!0,s=e.target.result},n.onerror=o,a},batch:function(n,r,o){if(o||(o=e),r||(r=t),"[object Array]"!=Object.prototype.toString.call(n))o(Error("dataArray argument must be of type Array."));else if(0===n.length)return r(!0);var i=this.db.transaction([this.storeName],this.consts.READ_WRITE);i.oncomplete=function(){(c?r:o)(c)},i.onabort=o,i.onerror=o;var s=n.length,a=!1,c=!1,l=function(){s--,0===s&&!a&&(c=a=!0)};return n.forEach(function(e){var t=e.type,n=e.key,r=e.value,e=function(e){i.abort(),a||(a=!0,o(e,t,n))};"remove"==t?(r=i.objectStore(this.storeName)["delete"](n),r.onsuccess=l,r.onerror=e):"put"==t&&(null!==this.keyPath?(this._addIdPropertyIfNeeded(r),r=i.objectStore(this.storeName).put(r)):r=i.objectStore(this.storeName).put(r,n),r.onsuccess=l,r.onerror=e)},this),i},putBatch:function(e,t,n){return this.batch(e.map(function(e){return{type:"put",value:e}}),t,n)},upsertBatch:function(n,r,o,i){"function"==typeof r&&(i=o=r,r={}),i||(i=e),o||(o=t),r||(r={}),"[object Array]"!=Object.prototype.toString.call(n)&&i(Error("dataArray argument must be of type Array."));var s=this.db.transaction([this.storeName],this.consts.READ_WRITE);s.oncomplete=function(){u?o(n):i(!1)},s.onabort=i,s.onerror=i;var a=r.keyField||this.keyPath,c=n.length,l=!1,u=!1,h=0,f=function(e){n[h++][a]=e.target.result,c--,0===c&&!l&&(u=l=!0)};return n.forEach(function(e){var t=e.key;null!==this.keyPath?(this._addIdPropertyIfNeeded(e),e=s.objectStore(this.storeName).put(e)):e=s.objectStore(this.storeName).put(e,t),e.onsuccess=f,e.onerror=function(e){s.abort(),l||(l=!0,i(e))}},this),s},removeBatch:function(e,t,n){return this.batch(e.map(function(e){return{type:"remove",key:e}}),t,n)},getBatch:function(n,r,o,i){if(o||(o=e),r||(r=t),i||(i="sparse"),"[object Array]"!=Object.prototype.toString.call(n))o(Error("keyArray argument must be of type Array."));else if(0===n.length)return r([]);var s=this.db.transaction([this.storeName],this.consts.READ_ONLY);s.oncomplete=function(){(l?r:o)(u)},s.onabort=o,s.onerror=o;var a=[],c=n.length,l=!1,u=null,h=function(e){e.target.result||"dense"==i?a.push(e.target.result):"sparse"==i&&a.length++,c--,0===c&&(l=!0,u=a)};return n.forEach(function(e){e=s.objectStore(this.storeName).get(e),e.onsuccess=h,e.onerror=function(e){u=e,o(e),s.abort()}},this),s},getAll:function(n,r){r||(r=e),n||(n=t);var o=this.db.transaction([this.storeName],this.consts.READ_ONLY),i=o.objectStore(this.storeName);return i.getAll?this._getAllNative(o,i,n,r):this._getAllCursor(o,i,n,r),o},_getAllNative:function(e,t,n,r){var o=!1,i=null;e.oncomplete=function(){(o?n:r)(i)},e.onabort=r,e.onerror=r,e=t.getAll(),e.onsuccess=function(e){o=!0,i=e.target.result},e.onerror=r},_getAllCursor:function(e,t,n,r){var o=[],i=!1,s=null;e.oncomplete=function(){(i?n:r)(s)},e.onabort=r,e.onerror=r,e=t.openCursor(),e.onsuccess=function(e){(e=e.target.result)?(o.push(e.value),e["continue"]()):(i=!0,s=o)},e.onError=r},clear:function(n,r){r||(r=e),n||(n=t);var o=!1,i=null,s=this.db.transaction([this.storeName],this.consts.READ_WRITE);s.oncomplete=function(){(o?n:r)(i)},s.onabort=r,s.onerror=r;var a=s.objectStore(this.storeName).clear();return a.onsuccess=function(e){o=!0,i=e.target.result},a.onerror=r,s},_addIdPropertyIfNeeded:function(e){"undefined"==typeof e[this.keyPath]&&(e[this.keyPath]=this._insertIdCount++ +Date.now())},getIndexList:function(){return this.store.indexNames;
},hasIndex:function(e){return this.store.indexNames.contains(e)},normalizeIndexData:function(e){e.keyPath=e.keyPath||e.name,e.unique=!!e.unique,e.multiEntry=!!e.multiEntry},indexComplies:function(e,t){return["keyPath","unique","multiEntry"].every(function(n){if("multiEntry"==n&&void 0===e[n]&&!1===t[n])return!0;if("keyPath"==n&&"[object Array]"==Object.prototype.toString.call(t[n])){var n=t.keyPath,r=e.keyPath;if("string"==typeof r)return n.toString()==r;if("function"!=typeof r.contains&&"function"!=typeof r.indexOf||r.length!==n.length)return!1;for(var o=0,i=n.length;i>o;o++)if(!(r.contains&&r.contains(n[o])||r.indexOf(-1!==n[o])))return!1;return!0}return t[n]==e[n]})},iterate:function(t,n){var n=i({index:null,order:"ASC",autoContinue:!0,filterDuplicates:!1,keyRange:null,writeAccess:!1,onEnd:null,onError:e,limit:1/0,offset:0},n||{}),r="desc"==n.order.toLowerCase()?"PREV":"NEXT";n.filterDuplicates&&(r+="_NO_DUPLICATE");var o=!1,s=this.db.transaction([this.storeName],this.consts[n.writeAccess?"READ_WRITE":"READ_ONLY"]),a=s.objectStore(this.storeName);n.index&&(a=a.index(n.index));var c=0;return s.oncomplete=function(){o?n.onEnd?n.onEnd():t(null):n.onError(null)},s.onabort=n.onError,s.onerror=n.onError,r=a.openCursor(n.keyRange,this.consts[r]),r.onerror=n.onError,r.onsuccess=function(e){(e=e.target.result)?n.offset?(e.advance(n.offset),n.offset=0):(t(e.value,e,s),c++,n.autoContinue&&(c+n.offset<n.limit?e["continue"]():o=!0)):o=!0},s},query:function(e,t){var n=[],t=t||{};return t.autoContinue=!0,t.writeAccess=!1,t.onEnd=function(){e(n)},this.iterate(function(e){n.push(e)},t)},count:function(t,n){var n=i({index:null,keyRange:null},n||{}),r=n.onError||e,o=!1,s=null,a=this.db.transaction([this.storeName],this.consts.READ_ONLY);a.oncomplete=function(){(o?t:r)(s)},a.onabort=r,a.onerror=r;var c=a.objectStore(this.storeName);return n.index&&(c=c.index(n.index)),c=c.count(n.keyRange),c.onsuccess=function(e){o=!0,s=e.target.result},c.onError=r,a},makeKeyRange:function(e){var t="undefined"!=typeof e.lower,n="undefined"!=typeof e.upper,r="undefined"!=typeof e.only;switch(!0){case r:e=this.keyRange.only(e.only);break;case t&&n:e=this.keyRange.bound(e.lower,e.upper,e.excludeLower,e.excludeUpper);break;case t:e=this.keyRange.lowerBound(e.lower,e.excludeLower);break;case n:e=this.keyRange.upperBound(e.upper,e.excludeUpper);break;default:throw Error('Cannot create KeyRange. Provide one or both of "lower" or "upper" value, or an "only" value.')}return e}};var o={},i=function(e,t){var n,r;for(n in t)r=t[n],r!==o[n]&&r!==e[n]&&(e[n]=r);return e};return r.version=r.prototype.version,r},this),LauDB.debug=!1,IDBLauDB.__indexedsUsed=[],MproEntity.getWhere=function(classe){if(!arguments.length<=1){var elems=new Array,dataRequest=void 0,callBack=void 0,fields=new Array,instance=new classe,relations=new Array,namesTransient=new Array,remote=!1;if(namesTransient=MproEntityAnnotations.getTransients(instance),relations=MproEntityAnnotations.getReferences(instance),arguments[1].constructor!=MproEntity.DataRequest){var logics=[],tuples=[],sync=!0,end=!0,order="";dataRequest=new MproEntity.DataRequest,dataRequest.Name=instance["class"];for(var field in instance)instance[field]instanceof Array||namesTransient[field]||"getAll"!==field&&"cod"!==field&&"codRemote"!==field&&"class"!==field&&"Save"!==field&&"Delete"!==field&&"RefObject"!==field&&"function"!=typeof instance[field]&&(fields.push(field),dataRequest.Fields.push(field));for(var i=1;i<arguments.length-1;i++)if("function"!=typeof arguments[i])if(i%2!==0){if(arguments[i]["class"]===instance["class"])throw new Error("Ambiguos class search "+instance["class"]+'. Instead, use the argument "where" of getAll.');dataRequest.NameRefs.push(arguments[i]["class"]),dataRequest.FieldsRefs.push(arguments[i].field)}else dataRequest.LogicVals.push(arguments[i].val),dataRequest.Comparators.push(arguments[i].comparator),dataRequest.LogicNexts.push(arguments[i].logicNext);if(dataRequest.LogicVals.length!==dataRequest.NameRefs.length)throw new Error("Number of Related Entities not match the number of Logical Operations.");if("function"!=typeof arguments[dataRequest.LogicVals.length+dataRequest.NameRefs.length+1])throw new Error("End Callback undefined.");if("function"!=typeof arguments[arguments.length-1]){var orObj=arguments[arguments.length-1];dataRequest.OrderBy+=" ORDER BY "+orObj.Classe["class"]+"."+orObj.Classe.field+" "+orObj.OrderBy}callBack=arguments[dataRequest.LogicVals.length+dataRequest.NameRefs.length+1]}else{if(dataRequest=arguments[1],fields=dataRequest.Fields,!arguments[2])throw new Error("End Callback undefined.");callBack=arguments[2],arguments[3]&&(remote=arguments[3])}if(MproEntity.indexedDB&&!remote&&MproEntity.getAll(classe,function(data){function compareAsc(e,t){return e[fid]<t[fid]?-1:e[fid]>t[fid]?1:0}function compareDesc(e,t){return e[fid]<t[fid]?1:e[fid]>t[fid]?-1:0}var res=data.filter(function(i){return eval(dataRequest.IndexWhere)}),pts=[],fid="";""!=dataRequest.OrderBy&&(pts=dataRequest.OrderBy.split(" "),fid=pts[1]),pts.length&&"ASC"==pts[2]?res=res.sort(compareAsc):pts.length&&"DESC"==pts[2]&&(res=res.sort(compareDesc)),callBack(res)}),!window.externalEnvironment||remote){var ajax=new Ajax;ajax.Url=(remote?MproEntity.remoteServer:MproEntity.serverUrl)+"/dataRequestService"+(remote?MproEntity.remoteServerTech:MproEntity.serverTech),ajax.setData({dataRequest:JSON.stringify(dataRequest),user:__projectUser__,cod:__projectCod__}),ajax.onSucces(function(e){var t=[];try{t=JSON.parse(e)}catch(n){throw new Error(e)}for(var r=[],o=0;o<t.length;o++){r=[];var i=t[o],s=new classe;remote?s.codRemote=i[0]:s.cod=i[0];for(var a=0;a<fields.length;a++)if(-1===fields[a].indexOf("Ref"))s[fields[a]]=i[a+1];else{r.push(fields[a]);var c=!1;o>=t.length-1&&(c=!0);var l=function(e,t,n,o,i,s,a){return function(c){c&&(e[t[n]]=c[0]),o&&s&&r.length===a&&o(i)}};remote?MproEntity.getAllRemote(window[fields[a].replace("Ref","")],l(s,fields,a,callBack,elems,c,r.length),"cod = "+i[a+1],void 0,1,void 0,!0,c):MproEntity.getAll(window[fields[a].replace("Ref","")],l(s,fields,a,callBack,elems,c,r.length),"cod = "+i[a+1],void 0,1,void 0,!0,c)}if(relations.length>0)for(var u=[],h=0;h<relations.length;h++){var c=!1;void 0!==u[relations[h].Name]?u[relations[h].Name]+=1:u[relations[h].Name]=1,h>=relations.length-1&&o>=t.length-1&&(c=!0);var f=function(e,t,n,r,o,i){return function(i,s){for(var a=0;a<i.length;a++)i[a].RefObject=e;null!==i&&(e[t[n].NameVar]=i),r&&o&&setTimeout(function(){r(elems)},500)}};remote?MproEntity.getAllRemote(window[relations[h].Name],f(s,relations,h,callBack,c,u[relations[h].Name]),void 0,void 0,void 0,s,!0,void 0,u[relations[h].Name]):MproEntity.getAll(window[relations[h].Name],f(s,relations,h,callBack,c,u[relations[h].Name]),void 0,void 0,void 0,s,!0,void 0,u[relations[h].Name])}elems.push(s)}0===relations.length&&0===r.length&&callBack(elems,end),0===t.length&&callBack(elems,end)}),ajax.execute(sync)}return externalEnvironment&&!remote&&externalEnvironment.requestService(JSON.stringify(dataRequest),function(e){for(var t=e,n=[],r=0;r<t.length;r++){n=[];var o=t[r],i=new classe;i.cod=o[0];for(var s=0;s<fields.length;s++)if(-1===fields[s].indexOf("Ref"))i[fields[s]]=o[s+1];else{n.push(fields[s]);var a=!1;r>=t.length-1&&(a=!0);var c=function(e,t,r,o,i,s,a){return function(c){c&&(e[t[r]]=c[0]),o&&s&&n.length===a&&o(i)}};MproEntity.getAll(window[fields[s].replace("Ref","")],c(i,fields,s,callBack,elems,a,n.length),"cod = "+o[s+1],void 0,1,void 0,!0,a)}if(relations.length>0)for(var l=[],u=0;u<relations.length;u++){var a=!1;void 0!==l[relations[u].Name]?l[relations[u].Name]+=1:l[relations[u].Name]=1,u>=relations.length-1&&r>=t.length-1&&(a=!0);var h=function(e,t,n,r,o,i){return function(i,s){for(var a=0;a<i.length;a++)i[a].RefObject=e;null!==i&&(e[t[n].NameVar]=i),r&&o&&setTimeout(function(){r(elems)},500)}};MproEntity.getAll(window[relations[u].Name],h(i,relations,u,callBack,a,l[relations[u].Name]),void 0,void 0,void 0,i,!0,void 0,l[relations[u].Name])}elems.push(i)}0===relations.length&&0===n.length&&callBack(elems,end),0===t.length&&callBack(elems,end)}),elems}return null},MproEntity.getAllRemote=function(e,t,n,r,o,i,s,a,c){if(void 0===e)return null;void 0===n&&(n=""),(void 0===r||""===r)&&(r="cod asc"),void 0===s&&(s=!0),void 0===a&&(a=!0);var l=new e,u=new Array,h=new Array,f=new Array,d=new Array,g="";h=MproEntityAnnotations.getTransients(l);for(var p in l)l[p]instanceof Array||h[p]||"getAll"!==p&&"cod"!==p&&"codRemote"!==p&&"class"!==p&&"Save"!==p&&"Delete"!==p&&"RefObject"!==p&&"function"!=typeof l[p]&&f.push(p);u=MproEntityAnnotations.getReferences(l);var m=new MproEntity.DataRequest;m.Name=l["class"],m.Where=n,m.OrderBy=r,void 0!==i&&(m.NameRef=i["class"],m.CodRef=i.codRemote,void 0!==c&&(m.Ix=c)),o&&o.length&&2===o.length&&(m.Limiter[0]=o[0],m.Limiter[1]=o[1],g+=" LIMIT "+o[0]+", "+o[1]);var y=new Ajax;y.Url=MproEntity.serverUrl+"/dataRequestAllService"+MproEntity.serverTech,y.setData({dataRequest:JSON.stringify(m),user:__projectUser__,cod:__projectCod__}),y.onSucces(function(n){for(var r=JSON.parse(n),o=[],i=0;i<r.length;i++){o=[];var s=r[i],c=new e;c.codRemote=s[0];for(var l=0;l<f.length;l++)if(-1===f[l].indexOf("Ref"))c[f[l]]=s[l+1];else{o.push(f[l]);var h=!1;i>=r.length-1&&(h=!0);var g=function(e,t,n,r,i,s,a){return function(c){c&&(e[t[n]]=c[0]),r&&s&&o.length===a&&r(i)}};MproEntity.getAllRemote(window[f[l].replace("Ref","")],g(c,f,l,t,d,h,o.length),"cod = "+s[l+1],void 0,1,void 0,!0,h)}if(u.length>0)for(var p=[],m=0;m<u.length;m++){var h=!1;void 0!==p[u[m].Name]?p[u[m].Name]+=1:p[u[m].Name]=1,m>=u.length-1&&i>=r.length-1&&(h=!0);var y=function(e,t,n,r,o,i){return function(i,s){for(var a=0;a<i.length;a++)i[a].RefObject=e;null!==i&&(e[t[n].NameVar]=i),r&&o&&setTimeout(function(){r(d)},500)}};MproEntity.getAllRemote(window[u[m].Name],y(c,u,m,t,h,p[u[m].Name]),void 0,void 0,void 0,c,!0,void 0,p[u[m].Name])}d.push(c)}0===u.length&&0===o.length&&t(d,a),0===r.length&&t(d,a)}),y.execute(s)},MproEntity.getAll=function(e,t,n,r,o,i,s,a,c){if(void 0===e)return null;void 0===n&&(n=""),(void 0===r||""===r)&&(r="cod asc"),void 0===s&&(s=!0),void 0===a&&(a=!0);var l=new e,u=new Array,h=new Array,f=new Array,d=new Array,g="";h=MproEntityAnnotations.getTransients(l);for(var p in l)l[p]instanceof Array||h[p]||"getAll"!==p&&"cod"!==p&&"codRemote"!==p&&"class"!==p&&"Save"!==p&&"Delete"!==p&&"RefObject"!==p&&"function"!=typeof l[p]&&f.push(p);u=MproEntityAnnotations.getReferences(l);var m=new MproEntity.DataRequest;if(m.Name=l["class"],m.Where=n,m.OrderBy=r,void 0!==i&&(m.NameRef=i["class"],m.CodRef=i.cod,void 0!==c&&(m.Ix=c)),o&&o.length&&2===o.length&&(m.Limiter[0]=o[0],m.Limiter[1]=o[1],g+=" LIMIT "+o[0]+", "+o[1]),MproEntity.indexedDB){var y=new IDBLauDB;y.setJSONObject(m,function(){y.selectAll(function(e){for(var n=0;n<e.length;n++)e[n]=MproEntity.extend(window[m.Name],e[n]);t(e)})})}else if(window.externalEnvironment)externalEnvironment.requestAllService(JSON.stringify(m),function(n){for(var r=n,o=[],i=0;i<r.length;i++){o=[];var s=r[i],c=new e;c.cod=s[0];for(var l=0;l<f.length;l++)if(-1===f[l].indexOf("Ref"))c[f[l]]=s[l+1];else{o.push(f[l]);var h=!1;i>=r.length-1&&(h=!0);var g=function(e,t,n,r,i,s,a){return function(c){c&&(e[t[n]]=c[0]),r&&s&&o.length===a&&r(i)}};MproEntity.getAll(window[f[l].replace("Ref","")],g(c,f,l,t,d,h,o.length),"cod = "+s[l+1],void 0,1,void 0,!0,h)}if(u.length>0)for(var p=[],m=0;m<u.length;m++){var h=!1;void 0!==p[u[m].Name]?p[u[m].Name]+=1:p[u[m].Name]=1,m>=u.length-1&&i>=r.length-1&&(h=!0);var y=function(e,t,n,r,o,i){return function(i,s){for(var a=0;a<i.length;a++)i[a].RefObject=e;null!==i&&(e[t[n].NameVar]=i),r&&o&&setTimeout(function(){r(d)},500)}};MproEntity.getAll(window[u[m].Name],y(c,u,m,t,h,p[u[m].Name]),void 0,void 0,void 0,c,!0,void 0,p[u[m].Name])}d.push(c)}0===u.length&&0===o.length&&t(d,a),0===r.length&&t(d,a)});else{var b=new Ajax;b.Url=MproEntity.serverUrl+"/dataRequestAllService"+MproEntity.serverTech,b.setData({dataRequest:JSON.stringify(m),user:__projectUser__,cod:__projectCod__}),b.onSucces(function(n){for(var r=JSON.parse(n),o=[],i=0;i<r.length;i++){o=[];var s=r[i],c=new e;c.cod=s[0];for(var l=0;l<f.length;l++)if(-1===f[l].indexOf("Ref"))c[f[l]]=s[l+1];else{o.push(f[l]);var h=!1;i>=r.length-1&&(h=!0);var g=function(e,t,n,r,i,s,a){return function(c){c&&(e[t[n]]=c[0]),r&&s&&o.length===a&&r(i)}};MproEntity.getAll(window[f[l].replace("Ref","")],g(c,f,l,t,d,h,o.length),"cod = "+s[l+1],void 0,1,void 0,!0,h)}if(u.length>0)for(var p=[],m=0;m<u.length;m++){var h=!1;void 0!==p[u[m].Name]?p[u[m].Name]+=1:p[u[m].Name]=1,m>=u.length-1&&i>=r.length-1&&(h=!0);var y=function(e,t,n,r,o,i){return function(i,s){for(var a=0;a<i.length;a++)i[a].RefObject=e;null!==i&&(e[t[n].NameVar]=i),r&&o&&setTimeout(function(){r(d)},500)}};MproEntity.getAll(window[u[m].Name],y(c,u,m,t,h,p[u[m].Name]),void 0,void 0,void 0,c,!0,void 0,p[u[m].Name])}d.push(c)}0===u.length&&0===o.length&&t(d,a),0===r.length&&t(d,a)}),b.execute(s)}return d},MproEntity.query=function(e){return new Query(e)},MproEntity.remoteServer=null,MproEntity.remoteServerTech=null,MproEntity.serverUrl="",MproEntity.serverTech="",MproEntity.serverSeted=!1,MproEntity.canCreateTables=!0,MproEntity.indexedDB=!1,MproEntity.indexedDBVersion=1,MproEntity.setServer=function(e,t){window.externalEnvironment=void 0,MproEntity.serverUrl=e,MproEntity.serverTech=void 0==t?"":"."+t,MproEntity.serverSeted=!0},MproEntity.setRemoteServer=function(e,t){MproEntity.remoteServer=e,MproEntity.remoteServerTech=void 0==t?"":"."+t},MproEntity.enableWebSQL=function(){window.externalEnvironment=new InternalEnviroment},MproEntity.enableIndexedDB=function(){MproEntity.indexedDB=!0},MproEntity.Logic=function(e,t,n){this.val=e,this.comparator=t,this.logicNext=n},MproEntity.Order=function(e,t){this.Classe=e,this.OrderBy=t},MproEntity.DataRecord=function(){this.Name="",this.Cod=2147483647,this.Fields=[],this.Data=[],this.Remote=!1},MproEntity.DataReference=function(){this.NameRef="",this.Name="",this.Ix=2147483647,this.CodRef=2147483647,this.Cod=2147483647},MproEntity.DataRequest=function(){this.Name="",this.Where="",this.IndexWhere="",this.OrderBy="",this.Ix=2147483647,this.NameRef="",this.CodRef=2147483647,this.Limiter=[],this.NameRefs=[],this.FieldsRefs=[],this.LogicVals=[],this.Comparators=[],this.LogicNexts=[],this.Fields=[]},MproEntity.CreateTable=function(){this.Name="",this.Fields=[],this.Types=[]},MproEntity.extend=function(e,t){var n=new e;for(var r in t)n[r]=t[r];return n},MproEntity.GT=" > ",MproEntity.GTE=" >= ",MproEntity.LT=" < ",MproEntity.LTE=" <= ",MproEntity.LIKE=" LIKE ",MproEntity.EQUAL=" = ",MproEntity.AND=" AND ",MproEntity.OR=" OR ",__projectUser__=0,__projectCod__=0,window.MproEntityAnnotations={},MproEntityAnnotations.getTransients=function(e){var t=[];if(!e["class"])throw new Error("Instance of object is not an MproEntity.");for(var n=window[e["class"]].toString(),r=n.locations("@Transient"),o=0;o<r.length;o++){var i="";i=n.substring(r[o]+n.substring(r[o],n.length).indexOf("this"),r[o]+n.substring(r[o],n.length).indexOf("=")).replace("this.","").trim(),""!==i&&(t[i]=!0)}return t},MproEntityAnnotations.getReferences=function(e){var t=[];if(!e["class"])throw new Error("Instance of object is not an MproEntity.");for(var n=window[e["class"]].toString(),r=n.locations("@Reference"),o=[],i=0;i<r.length;i++){var s={};if(s.Name=n.substring(r[i],r[i]+n.substring(r[i],n.length).indexOf("this")).replace(/.*\@Reference<|\>/gi,"").trim(),o[s.Name]?o[s.Name]+=1:o[s.Name]=1,s.Ix=o[s.Name],s.NameVar=n.substring(r[i]+n.substring(r[i],n.length).indexOf("this"),r[i]+n.substring(r[i],n.length).indexOf("=")).replace("this.","").trim(),!window[s.Name])throw new Error(s.Name+" is not an MproEntity or is not load.");if(!(e[s.NameVar]instanceof Array))throw new Error(e["class"]+"."+s.NameVar+" is not a collection.");t.push(s)}return t},String.prototype.locations=function(e){for(var t=[],n=-1;(n=this.indexOf(e,n+1))>=0;)t.push(n);return t};